<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Absensi Keterlambatan Pegawai</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        /* Custom styles untuk mobile */
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 500px;
            padding-top: 1.5rem;
            padding-bottom: 1.5rem;
        }
        
        .card {
            border-radius: 15px;
            border: none;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .form-control, .form-select {
            border-radius: 10px;
            padding: 12px 15px;
            border: 1px solid #e1e5ee;
            transition: all 0.3s ease;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: #4dabf7;
            box-shadow: 0 0 0 0.2rem rgba(77, 171, 247, 0.25);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #4dabf7 0%, #339af0 100%);
            border: none;
            border-radius: 10px;
            padding: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #339af0 0%, #228be6 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(51, 154, 240, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #40c057 0%, #2f9e44 100%);
            border: none;
            border-radius: 10px;
            padding: 12px 25px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-success:hover {
            background: linear-gradient(135deg, #2f9e44 0%, #2b8a3e 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(47, 158, 68, 0.4);
        }
        
        h2, h3 {
            color: #343a40;
            font-weight: 700;
        }
        
        .form-label {
            font-weight: 600;
            color: #495057;
            margin-bottom: 8px;
        }
        
        #dashboardArea {
            transition: all 0.5s ease;
        }
        
        /* Animasi untuk elemen yang muncul */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }
        
        /* Styling untuk chart */
        #grafikAbsensi {
            border-radius: 10px;
            background: white;
            padding: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
    </style>
</head>
<body class="bg-light">

<div class="container py-4">

    <h2 class="text-center mb-4">Form Keterlambatan Pegawai</h2>

    <!-- FORM -->
    <div class="card p-4 shadow-sm mb-4 fade-in">
        <form id="formAbsensi">
            <div class="mb-3">
                <label class="form-label">Nama Pegawai</label>
                <input type="text" id="nama" class="form-control" required>
            </div>

            <div class="mb-3">
                <label class="form-label">NPP Pegawai</label>
                <input type="text" id="npp" class="form-control" required>
            </div>

            <div class="mb-3">
                <label class="form-label">Divisi</label>
                <select id="divisi" class="form-select" required>                      
                    <option value="">-- Pilih Divisi --</option>
                    <option value="CSI">CSI</option>
                    <option value="FRM">FRM</option>
                    <option value="HCC">HCC</option>
                    <option value="INA">INA</option>
                    <option value="MBS">MBS</option>
                    <option value="OPS">OPS</option>
                    <option value="OPR-1">OPR-1</option>
                    <option value="OPR-2">OPR-2</option>
                    <option value="PLM">PLM</option>
                    <option value="SBD">SBD</option>      
                </select>
            </div>

            <div class="mb-3">
                <label class="form-label">Alasan Keterlambatan</label>
                <select id="alasan" class="form-select" required>                      
                    <option value="">-- Pilih Alasan Terlambat --</option>
                    <option value="Macet">Jalan Macet</option>
                    <option value="Rusak">Motor Rusak</option>
                    <option value="Telat">Bangun Telat</option>
                    <option value="Banjir">Banjir</option>
                    <option value="Hujan">Hujan</option>
                    <option value="Kecelakaan">Kecelakaan</option>
                    <option value="Ban">Ban bocor/kempes</option>
                    <option value="Tilang">Kena Tilang</option>
                    <option value="lainnya">Dan Lain-Lain</option>                    
                </select> 
            </div>

            <button type="submit" class="btn btn-primary w-100 mt-3">Kirim Data</button>
        </form>
    </div>

    <!-- BUTTON DASHBOARD -->
    <div class="text-center mb-4 fade-in">
        <button id="btnDashboard" class="btn btn-success">
            Lihat Dashboard
        </button>
    </div>

    <!-- DASHBOARD -->
    <div id="dashboardArea" class="mt-4 d-none fade-in">
        <h3 class="text-center mb-4">Dashboard Keterlambatan per Divisi</h3>
        <canvas id="grafikAbsensi" height="120"></canvas>
    </div>

</div>

<script>
/* ====== PASTE URL WEB APP GOOGLE SCRIPT ANDA DI SINI ====== */
const BASE_URL = "https://script.google.com/macros/s/AKfycbw7uDU-Kzp8Qcjr3L2oG_8JDXMTCy7TnONJLpyrEmVEUiLsgg1296IhWrPWrprvnn8/exec";

/* ====== KIRIM DATA FORM KE SPREADSHEET ====== */
document.getElementById("formAbsensi").addEventListener("submit", async (e) => {
    e.preventDefault();

    const nama = document.getElementById("nama").value;
    const npp = document.getElementById("npp").value;
    const divisi = document.getElementById("divisi").value;
    const alasan = document.getElementById("alasan").value;

    const url = `${BASE_URL}?mode=add&nama=${encodeURIComponent(nama)}&npp=${encodeURIComponent(npp)}&divisi=${encodeURIComponent(divisi)}&alasan=${encodeURIComponent(alasan)}`;

    const result = await fetch(url);
    const response = await result.text();

    alert(response);

    e.target.reset();
});

/* ====== TAMPILKAN DASHBOARD ====== */
document.getElementById("btnDashboard").addEventListener("click", async () => {
    const url = `${BASE_URL}?mode=grafik`;

    const result = await fetch(url);
    const data = await result.json();

    /*
      data = [
        ["HRD", 3],
        ["Finance", 5],
        ["IT", 2]
      ]
    */

    const labels = data.map(item => item[0]);
    const values = data.map(item => item[1]);

    document.getElementById("dashboardArea").classList.remove("d-none");

    new Chart(document.getElementById("grafikAbsensi"), {
        type: "bar",
        data: {
            labels: labels,
            datasets: [{
                label: "Jumlah Keterlambatan",
                data: values,
                backgroundColor: [
                    'rgba(255, 99, 132, 0.7)',
                    'rgba(54, 162, 235, 0.7)',
                    'rgba(255, 206, 86, 0.7)',
                    'rgba(75, 192, 192, 0.7)',
                    'rgba(153, 102, 255, 0.7)',
                    'rgba(255, 159, 64, 0.7)',
                    'rgba(199, 199, 199, 0.7)',
                    'rgba(83, 102, 255, 0.7)',
                    'rgba(40, 159, 64, 0.7)',
                    'rgba(210, 99, 132, 0.7)'
                ],
                borderColor: [
                    'rgba(255, 99, 132, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(75, 192, 192, 1)',
                    'rgba(153, 102, 255, 1)',
                    'rgba(255, 159, 64, 1)',
                    'rgba(199, 199, 199, 1)',
                    'rgba(83, 102, 255, 1)',
                    'rgba(40, 159, 64, 1)',
                    'rgba(210, 99, 132, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        stepSize: 1
                    }
                }
            }
        }
    });
});

// Menambahkan animasi fade-in saat halaman dimuat
document.addEventListener('DOMContentLoaded', function() {
    const elements = document.querySelectorAll('.fade-in');
    elements.forEach(element => {
        element.style.opacity = '0';
    });
    
    setTimeout(() => {
        elements.forEach(element => {
            element.style.opacity = '1';
        });
    }, 100);
});
</script>

</body>
</html>
